
OpenRTMプラグインの使用準備
===========================

本ページではOpenRTMプラグインを使用するための準備について解説します。

.. contents::
   :local:

.. highlight:: sh

.. _openrtmplugin_install_openrtm:

インストール
------------

OpenRTMプラグインはChoreonoid本体からは独立して開発・配布されている `Choreonoid-OpenRTM <https://github.com/OpenRTM/choreonoid-openrtm>`_ に含まれています。

Choreonoid-OpenRTMのインストール方法に関しては上記ページ（Choreonoid-OpenRTMのREADME.md）をご参照ください。

CORBAの設定
-----------

omniORBの最大メッセージサイズの設定
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

OpenRTMを使用する際には、omniORBの最大メッセージサイズを増やしておいた方がよいです。omniORBというのはOpenRTM-aistの実装で使用されているCORBAライブラリで、OpenRTMのインストールの際にはこれもインストールされます。この設定ファイル /etc/omniORB.cfg がありますので、ルート権限でこのファイルを編集します。設定ファイルの中に ::

 giopMaxMsgSize = 2097152   # 2 MBytes.

という記述があるかと思うのですが、これが最大メッセージサイズを表しています。

デフォルトでは2MBとなっているのですが、この場合、例えば画像データやポイントクラウドデータの通信などで一度に2MB以上のサイズのデータを送信しようとすると、うまく送信できないことになってしまいます。2MBという値は小さいので、この値を増やしておきましょう。例えばこれを20MBにする場合、 ::

 giopMaxMsgSize = 20971520

に修正します。

.. _openrtm_install_clear_omninames_cache:

omniNamesのキャッシュのクリア
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

OpenRTMがベースとして利用しているCORBAという通信規格では、「ネームサーバ」というものを使用します。これはCORBAで扱う「CORBAオブジェクト」のネットワーク上でのアドレスを登録するためのものです。omniORBをインストールすると、omniNamesというネームサーバもインストールされ、デフォルトで使用されるようになっています。

このomniNamesについて、登録されていたオブジェクトの情報をOSの再起動時に復帰するという「キャッシュ」の機能があります。このキャッシュによって、存在しないオブジェクトの情報が蓄積してしまい、これがシステムの挙動に影響を与えることがあります。CORBAオブジェクトのアドレスはIPアドレスも含むものなので、ネットワーク上のPC構成が変わったり、ネットワーク自体が変わったりすると、容易にこの問題が発生します。

この問題を避けるため、ネットワーク構成が変わる度にキャッシュをクリアした方がよいです。キャッシュのクリアは

Linuxをご利用の場合は、 **reset-omninames.sh** というシェルスクリプトによってキャッシュをクリアすることができます。これはChoreonoidのビルドディレクトリやインストール先の **bin** ディレクトリにあります。このスクリプトをコマンドラインから、 ::

 reset-omninames.sh

として実行します。（binにパスが通っていない場合はパスもつけるようにしてください。）

このスクリプトの実行には管理者権限が必要です。実行時にはそのためのパスワードを求められた場合は、パスワードを入力して実行してください。

OpenRTM関連の動作がうまくいかない場合、キャッシュが悪さをしていることもありますので、その場合は一度システムを全て止めてから、このスクリプトを実行するとよいかと思います。
